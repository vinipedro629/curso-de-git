<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ToDoApp - Agenda de Tarefas</title>
  <style>
    :root{
      --bg:#f4f7fb;
      --card:#ffffff;
      --primary:#2563eb;
      --accent:#10b981;
      --danger:#ef4444;
      --muted:#6b7280;
      --glass: rgba(255,255,255,0.6);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#e9eef8);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
    .container{width:100%;max-width:980px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    header h1{margin:0;font-size:20px;color:#0f172a}
    header p{margin:0;color:var(--muted);font-size:13px}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(15,23,42,0.08)}
    .top{display:flex;gap:12px;align-items:center;margin-bottom:14px}
    .form{display:flex;gap:8px;flex-wrap:wrap}
    input[type=text], input[type=date], textarea, select{padding:8px 10px;border:1px solid #e6edf7;border-radius:8px;font-size:14px}
    textarea{min-height:60px;resize:vertical}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:8px;border:0;background:var(--primary);color:white;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--muted);border:1px solid #e6edf7}
    .btn.warn{background:var(--accent)}
    .controls{display:flex;gap:8px;align-items:center}
    .filters{display:flex;gap:6px}
    .filters button{padding:6px 10px;border-radius:999px;border: none;background:#f3f4f6;color:#374151;cursor:pointer}
    .filters button.active{background:var(--primary);color:white}
    .list{margin-top:12px}
    .task{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;border:1px solid #f0f4fb;background:linear-gradient(180deg,rgba(255,255,255,0.6),transparent);margin-bottom:8px}
    .task .left{display:flex;gap:12px;align-items:center}
    .status-btn{width:36px;height:36px;border-radius:8px;border:0;display:inline-grid;place-items:center;cursor:pointer}
    .meta{display:flex;flex-direction:column}
    .title{font-weight:600}
    .date{font-size:13px;color:var(--muted)}
    .actions{display:flex;gap:8px;align-items:center}
    .icon-btn{background:transparent;border:0;padding:6px;border-radius:8px;cursor:pointer}
    .badge{background:#eef2ff;color:#312e81;padding:6px 9px;border-radius:999px;font-size:13px}
    .muted{color:var(--muted)}
    .strike{text-decoration:line-through;color:#9ca3af}
    @media (max-width:720px){
      .form{flex-direction:column}
      .controls{flex-direction:column;align-items:stretch}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>ToDoApp ‚Äî Agenda de Tarefas</h1>
        <p>Cadastre, edite e organize suas tarefas. Salvas no seu navegador.</p>
      </div>
      <div class="badge" id="countBadge">0 pendentes</div>
    </header>

    <div class="card">
      <div class="top">
        <form id="taskForm" class="form" onsubmit="return false">
          <input type="hidden" id="taskId" />
          <input id="title" type="text" placeholder="T√≠tulo (obrigat√≥rio)" required />
          <input id="date" type="date" required />
          <input id="status" type="hidden" value="Pendente" />
          <textarea id="description" placeholder="Descri√ß√£o (opcional)"></textarea>
          <button class="btn" id="saveBtn">Salvar</button>
          <button class="btn ghost" id="clearBtn" type="button">Limpar</button>
        </form>
        <div class="controls">
          <div class="filters" role="tablist" aria-label="Filtros">
            <button data-filter="" class="active">Todas</button>
            <button data-filter="Pendente">Pendentes</button>
            <button data-filter="Conclu√≠da">Conclu√≠das</button>
          </div>
          <select id="sort" title="Ordenar por">
            <option value="date_asc">Data ‚Üë</option>
            <option value="date_desc">Data ‚Üì</option>
          </select>
        </div>
      </div>

      <div class="list" id="taskList">
        <!-- tarefas aparecer√£o aqui -->
      </div>

      <div class="muted" style="margin-top:12px;font-size:13px">Dicas: clique no √≠cone ‚úÖ para marcar conclu√≠do; use ‚úèÔ∏è para editar e üóëÔ∏è para remover.</div>
    </div>
  </div>

  <script>
    // Estrutura de dados: { id, title, description, date, status }
    const storageKey = 'todoapp.tasks.v1';
    const taskForm = document.getElementById('taskForm');
    const titleInput = document.getElementById('title');
    const dateInput = document.getElementById('date');
    const descInput = document.getElementById('description');
    const statusInput = document.getElementById('status');
    const taskIdInput = document.getElementById('taskId');
    const taskListEl = document.getElementById('taskList');
    const countBadge = document.getElementById('countBadge');
    const filters = document.querySelectorAll('.filters button');
    const sortSelect = document.getElementById('sort');

    // Estado local
    let tasks = [];
    let currentFilter = '';

    function load(){
      try{
        const raw = localStorage.getItem(storageKey);
        tasks = raw ? JSON.parse(raw) : [];
      }catch(e){ tasks = []; }
      render();
    }

    function saveAll(){
      localStorage.setItem(storageKey, JSON.stringify(tasks));
    }

    function uid(){
      return Date.now().toString(36) + Math.random().toString(36).slice(2,8);
    }

    function clearForm(){
      taskIdInput.value='';
      titleInput.value='';
      dateInput.value='';
      descInput.value='';
      statusInput.value='Pendente';
      saveBtn.textContent = 'Salvar';
    }

    function addOrUpdateTask(){
      const title = titleInput.value.trim();
      const date = dateInput.value;
      const desc = descInput.value.trim();
      const status = statusInput.value || 'Pendente';
      if(!title){ alert('T√≠tulo √© obrigat√≥rio'); return }
      if(!date){ alert('Data √© obrigat√≥ria'); return }
      const existingId = taskIdInput.value;
      if(existingId){
        const idx = tasks.findIndex(t=>t.id===existingId);
        if(idx>-1){
          tasks[idx].title = title;
          tasks[idx].description = desc;
          tasks[idx].date = date;
          tasks[idx].status = status;
        }
      }else{
        tasks.push({ id: uid(), title, description: desc, date, status });
      }
      saveAll();
      render();
      clearForm();
    }

    function deleteTask(id){
      if(!confirm('Remover essa tarefa?')) return;
      tasks = tasks.filter(t=>t.id!==id);
      saveAll();
      render();
    }

    function editTask(id){
      const t = tasks.find(x=>x.id===id);
      if(!t) return;
      taskIdInput.value = t.id;
      titleInput.value = t.title;
      dateInput.value = t.date;
      descInput.value = t.description;
      statusInput.value = t.status;
      saveBtn.textContent = 'Atualizar';
      window.scrollTo({top:0,behavior:'smooth'});
    }

    function toggleStatus(id){
      const idx = tasks.findIndex(t=>t.id===id);
      if(idx===-1) return;
      tasks[idx].status = tasks[idx].status === 'Pendente' ? 'Conclu√≠da' : 'Pendente';
      saveAll();
      render();
    }

    function applyFilter(list){
      if(!currentFilter) return list;
      return list.filter(t=>t.status===currentFilter);
    }

    function applySort(list){
      const mode = sortSelect.value;
      const copy = [...list];
      copy.sort((a,b)=>{
        if(mode==='date_asc') return new Date(a.date) - new Date(b.date);
        return new Date(b.date) - new Date(a.date);
      });
      return copy;
    }

    function render(){
      // contar pendentes
      const pendingCount = tasks.filter(t=>t.status==='Pendente').length;
      countBadge.textContent = pendingCount + ' pendentes';

      let list = applyFilter(tasks);
      list = applySort(list);

      taskListEl.innerHTML = '';
      if(list.length===0){
        taskListEl.innerHTML = '<div class="muted">Nenhuma tarefa encontrada.</div>';
        return;
      }

      for(const t of list){
        const div = document.createElement('div');
        div.className = 'task';

        const left = document.createElement('div');
        left.className = 'left';

        const statusBtn = document.createElement('button');
        statusBtn.className = 'status-btn';
        statusBtn.title = t.status === 'Pendente' ? 'Marcar como Conclu√≠da' : 'Marcar como Pendente';
        statusBtn.innerHTML = t.status==='Pendente' ? '‚úÖ' : '‚Ü©Ô∏è';
        statusBtn.onclick = ()=> toggleStatus(t.id);

        const meta = document.createElement('div');
        meta.className = 'meta';
        const title = document.createElement('div');
        title.className = 'title';
        title.textContent = t.title;
        const date = document.createElement('div');
        date.className = 'date';
        date.textContent = (new Date(t.date)).toLocaleDateString();
        if(t.status === 'Conclu√≠da'){
          title.classList.add('strike');
        }

        meta.appendChild(title);
        meta.appendChild(date);

        left.appendChild(statusBtn);
        left.appendChild(meta);

        const actions = document.createElement('div');
        actions.className = 'actions';

        const editBtn = document.createElement('button');
        editBtn.className = 'icon-btn';
        editBtn.title = 'Editar';
        editBtn.textContent = '‚úèÔ∏è';
        editBtn.onclick = ()=> editTask(t.id);

        const delBtn = document.createElement('button');
        delBtn.className = 'icon-btn';
        delBtn.title = 'Excluir';
        delBtn.textContent = 'üóëÔ∏è';
        delBtn.onclick = ()=> deleteTask(t.id);

        actions.appendChild(editBtn);
        actions.appendChild(delBtn);

        div.appendChild(left);
        div.appendChild(actions);

        taskListEl.appendChild(div);
      }
    }

    // eventos
    const saveBtn = document.getElementById('saveBtn');
    const clearBtn = document.getElementById('clearBtn');
    taskForm.addEventListener('submit', (e)=>{ e.preventDefault(); addOrUpdateTask(); });
    clearBtn.addEventListener('click', clearForm);

    filters.forEach(f=> f.addEventListener('click', ()=>{
      filters.forEach(x=>x.classList.remove('active'));
      f.classList.add('active');
      currentFilter = f.dataset.filter || '';
      render();
    }));

    sortSelect.addEventListener('change', ()=> render());

    // inicializar
    load();
  </script>
</body>
</html>